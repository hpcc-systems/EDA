<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>AddFileRelationship</title><link rel="stylesheet" href="eclipsehelp.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.1"><link rel="home" href="index.html" title="ECL Reference"><link rel="up" href="bk02ch05.html" title="File Browsing"><link rel="prev" href="bk02ch05s02.html" title="GetColumnMapping"><link rel="next" href="bk02ch05s04.html" title="FileRelationshipList"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center"><span class="bold"><strong>AddFileRelationship</strong></span></th></tr><tr><td width="20%" align="left"><a accesskey="p" href="bk02ch05s02.html">Prev</a>&nbsp;</td><th width="60%" align="center"><span class="emphasis"><em>File Browsing </em></span></th><td width="20%" align="right">&nbsp;<a accesskey="n" href="bk02ch05s04.html">Next</a></td></tr></table><hr></div><div class="sect1" title="AddFileRelationship"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="AddFileRelationship"></a><span class="bold"><strong>AddFileRelationship</strong></span></h2></div></div></div><p><span class="bold"><strong>STD.File.AddFileRelationship<a class="indexterm" name="d4e17530"></a><a class="indexterm" name="d4e17532"></a><a class="indexterm" name="d4e17534"></a>(</strong></span> <span class="emphasis"><em> primary, secondary,</em></span> <span class="emphasis"><em> primaryfields, secondaryfields, </em></span> <span class="bold"><strong> [ </strong></span> <span class="emphasis"><em>relationship </em></span> <span class="bold"><strong>]</strong></span> <span class="emphasis"><em>, cardinality, payload </em></span> <span class="bold"><strong> [</strong></span> <span class="emphasis"><em>, description </em></span> <span class="bold"><strong>] );</strong></span></p><div class="informaltable"><table border="0"><colgroup><col width="13%"><col width="87%"></colgroup><tbody><tr><td><span class="emphasis"><em>primary</em></span></td><td>A null-terminated string containing the logical filename of the primary file.</td></tr><tr><td><span class="emphasis"><em>secondary</em></span></td><td>A null-terminated string containing the logical filename of the secondary file.</td></tr><tr><td><span class="emphasis"><em>primaryfields</em></span></td><td>A null-terminated string containing the name of the primary key field for the <span class="emphasis"><em>primary</em></span> file. The value &#8220;__fileposition__&#8221; indicates the <span class="emphasis"><em>secondary</em></span> is an INDEX that must use FETCH to access non-keyed fields.</td></tr><tr><td><span class="emphasis"><em>secondaryfields</em></span></td><td>A null-terminated string containing the name of the foreign key field relating to the <span class="emphasis"><em>primary</em></span> file.</td></tr><tr><td><span class="emphasis"><em>relationship</em></span></td><td>A null-terminated string containing either &#8220;link&#8221; or &#8220;view&#8221; indicating the type of relationship between the <span class="emphasis"><em>primary</em></span> and <span class="emphasis"><em>secondary</em></span> files. If omitted, the default is &#8220;link.&#8221;</td></tr><tr><td><span class="emphasis"><em>cardinality</em></span></td><td>A null-terminated string containing the kind of relationship between the <span class="emphasis"><em>primary</em></span> and <span class="emphasis"><em>secondary</em></span> files. The format is X:Y where X indicates the <span class="emphasis"><em>primary</em></span> and Y indicates the <span class="emphasis"><em>secondary</em></span>. Valid values for X and Y are &#8220;1&#8221; or &#8216;M&#8217;.</td></tr><tr><td><span class="emphasis"><em>payload</em></span></td><td>A BOOLEAN value indicating whether the <span class="emphasis"><em>primary</em></span> or <span class="emphasis"><em>secondary</em></span> are payload INDEXes.</td></tr><tr><td><span class="emphasis"><em>description</em></span></td><td>A null-terminated string containing the relationship description.</td></tr></tbody></table></div><p>The <span class="bold"><strong>AddFileRelationship</strong></span> function defines the relationship between two files. These may be DATASETs or INDEXes. Each record in the <span class="emphasis"><em>primary</em></span> file should be uniquely defined by the <span class="emphasis"><em>primaryfields</em></span> (ideally), preferably efficiently.</p><p>The <span class="emphasis"><em>primaryfields</em></span> and <span class="emphasis"><em>secondaryfields</em></span> parameters can have the same format as the column mappings for a file (see the SetColumnMappings function documentation) , although they will often be just a list of fields.</p><p>They are currently used in two different ways:</p><p>First, the roxie browser needs a way of determining which indexes are built from which files. A &#8220;view&#8221; relationship should be added each time an index is built from a file, like this:</p><pre class="programlisting">STD.File.AddFileRelationship(DG_FlatFileName, DG_IndexFileName,
                             '', '', 'view', '1:1', false);</pre><p>To implement the roxie browser there is no need to define the <span class="emphasis"><em>primaryfields</em></span> or <span class="emphasis"><em>secondaryfields</em></span>, so passing blank strings is recommended.</p><p>Second, the browser needs a way of finding all the original information from the file from an index.</p><p>This stage depends on the nature of the index:</p><p>a) If the index contains all the relevant data from the original file you don't need to do anything.</p><p>b) If the index uses a fileposition field to FETCH extra data from the original file then add a relationship between the original file and the index, using a special value of __fileposition__ to indicate the record is retrieved using a FETCH.</p><pre class="programlisting">STD.File.AddFileRelationship('fetch_file', 
                             'new_index',
                             '__fileposition__',
                             'index_filepos_field', 
                             'link',
                             '1:1', 
                             true);</pre><p>The original file is the primary, since the rows are uniquely identified by the fileposition (also true of the index), and the retrieval is efficient.</p><p>c) If the index uses a payload field which needs to be looked up in another index to provide the information, then you need to define a relationship between the new index and the index that provides the extra information. The index providing the extra information is the primary.</p><pre class="programlisting">STD.File.AddFileRelationship('related_index', 
                             'new_index',
                             'related_key_fields',
                             'index_filepos_field', 
                             'link',
                             '1:M', 
                             true);</pre><p>The <span class="emphasis"><em>payload </em></span>flag is there so that the roxie browser can distinguish this link from a more general relationship between two files.</p><p>You should ensure any super-file names are expanded if the relation is defined between the particular sub-files.</p><p>While going through all the attributes it may be worth examining whether it makes sense to add relationships for any other combinations of files. It won&#8217;t have any immediate beneficial effect, but would once we add an ER diagram to the system. A couple of examples may help illustrate the syntax.</p><p>For a typical example, datasets with a household and person file, the following defines a relationship linking by house hold id (hhid):</p><pre class="programlisting">STD.File.AddFileRelationship('HHFile','PersonFile', 'hhid','hhid', 'link', '1:M', false);</pre><p>Here's a more hypothetical example&#8212;a file query with firstname, lastname related to an index with phonetic names you might have:</p><pre class="programlisting">STD.File.AddFileRelationship('names', 'inquiries','plastname{set(phonetic)},
                             pfirstname{set(phonetic)}',
                             'lastname{set(fail)},firstname{set(fail)}','link', '1:M', false);</pre><p>Note, the fail mapping indicates that you can use the phonetic mapping from inquiries to names, but there is no way of mapping from names to inquiries. There could equally be get(fail) attributes on the index fields.</p><p>Example:</p><pre class="programlisting">Maps := STD.File.GetColumnMapping('Thor::in::SomeFile');
</pre></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="bk02ch05s02.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="bk02ch05.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="bk02ch05s04.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top"><span class="bold"><strong>GetColumnMapping</strong></span>&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;<span class="bold"><strong>FileRelationshipList</strong></span></td></tr></table></div></body></html>